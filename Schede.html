<!DOCTYPE html>

<html>
<head>
	<title>Schede</title>
	<meta charset="windows-1252" />
</head>

<body style="font-family:Courier New; font-size:9pt">

<script>
	 
	document.write(new Date().getTime(), '<br><br>')
	
	function shift1(v) { // clona v[] dal secondo elemento
		for (var r=[], i=1, e=v.length; i<e; i+=1) r[i-1] = v[i]; return r
	}
	function subn(z, s) { // clona z[] sottranedo agli elementi s
		if (s==0) return z
		for (var r=[], i=0, e=z.length; i<e; i+=1) r[i] = Math.max(0, z[i]-s) //z[i]<=s?0:z[i]-s
		return r
	}
	function subv(a, b) { // clona a[] sottraendo agli elementi b[]
		for (var r=[], i=0, e=a.length; i<e; i+=1) if ((r[i] = a[i] - b[i]) < 0) return
		return r
	}
	function subm(z, m) { // clona z[] sottranedo le colonne di m[,]
		var r=[]; for (var n of z) r.push(n)
		for (var v of m) for (var i=0, e=v.length; i<e; i+=1) if ((r[i] -= v[i]) < 0) return
		return r
	}
	function sum(a, b) { // somma a[] a b[]
		for (var r=[], i=0, e=a.length; i<e; i+=1) r[i] = a[i] + b[i]
		return r
	}

	function R(rs, z) {
		// rs: elementi per riga
		// z[]: elementi per colonna
		return R(rs, z, [])
		
		function* R(rs, z, v) {
			if (z.length == 0)
				yield v
			else for (var n=z.length>rs?0:1, e=z[0]==0?0:1; n<=e; n+=1) {
				var rsn = rs-n
				if (rsn < 0) continue
				yield* R(rsn, shift1(z), v.concat(n))
			}
		}
	}
	
	//writeAll( R(0, [0,0]) ) // 1
	//writeAll( R(3, [10,10,10,10,10,10]) ) // 20
	
	function M(r, rs, z) {
		// r: righe per scheda
		// rs: elementi per riga
		// z[]: elementi per colonna
		return M(z, Array(z.length).fill(0), [])
		
		function* M(z, cs, m) {
			// cs[]: totali per colonna
			if (m.length == r) {
				// se non ci sono totali colonna a zero 
				if (cs.indexOf(0) == -1) yield m // [m,z] ... fondo
			}
			else for (var v of R(rs, z)) {
				var nz = subv(z, v)
				if (!nz) continue
				yield* M(nz, sum(cs, v), m.concat([v]))
			}
		}
	}
	
	//writeAll( M(3, 5, [4,4,4,4,4,4]) ) // 210
	//writeAll( M(3, 5, [5,5,5,5,5,5]) ) // 210
	//writeAll( M(3, 5, [10,10,10,10,10,10,10,10]) ) // 107.520
	//writeAll( M(3, 5, [9,10,10,10,10,10,10,10,11]) )
	
	function T(s, r, rs, z) {
		// s: numero schede
		// r: righe per scheda
		// rs: elementi per riga
		// z[]: elementi per colonna
		return T(s, z, [])
		
		function* T(s, z, t) {
			if (s == 0) {
				for (n of z) if (n > 0)	return
				yield t
			}
			else for (var m of M(r, rs, subn(z, s-=1))) {
				var nz = subm(z, m)
				if (!nz) continue
				yield* T(s, nz, t.concat([m]))
			}	
		}
	}
	
	//writeAll( T(2, 3, 4, [4,4,4,4,4,4]) )
	//writeAll( T(2, 3, 4, [3,4,4,4,4,5]) )
	writeAll( T(6, 3, 5, [9,10,10,10,10,10,10,10,11]) )
	
	function writeAll(t) {
		var tm=new Date().getTime(), inc=3000, lim=inc
		//if (t instanceof ((function*() {yield* undefined}).constructor)) {
		//if (t == '[object Generator]') {
		if (true) {
			setTimeout(writeAll, 0, 1)
		}
		else
			document.write(t, '!<br>')			
			
		function writeAll(i) {
			var nt = t.next()
			if (nt.done) {
				document.write('<br style="clear:left">', 'Totale: ', i-1)
			}
			else {
				writeT(i, nt.value)
				if (i > lim) lim += (document.write(lim, ' (', new Date().getTime()-tm ,')', '<br>'), inc) // logging
				setTimeout(writeAll, 0, i+1)
			}
		}
	}
	
	function writeT(i, t) {
		//if (t.length) {
			if (t[0].length) {
				document.write('<div style="float:left; margin-right:10px; margin-bottom:10px">')
				document.write(i, ') <br>')
				if (t[0][0].length) {
					for (var m of t) {
						for (var r of m) document.write(r, '<br>')
						document.write('<br>')
					}
				}
				else {
					for (var r of t) document.write(r, '<br>')
					document.write('<br>')
				} 
				document.write('</div>')
				return 
			}
			document.write(i, ') ', t, '<br>')
		//}
	}
	
</script>

</body>
</html>
