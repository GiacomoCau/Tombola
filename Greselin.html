<!DOCTYPE html>

<html>
<head>
	<title>Untitled</title>
	<meta charset="windows-1252">
</head>

<body>

<script>

	var min = Math.min, max = Math.max
	
	function sum(v) { // somma tutti gli elementi di v
		for (var r=0, i=0, e=v.length; i<e; i+=1) r+=v[i]; return r
	}
	
	function sum1(v) { // somma tutti gli elementi di v tranne il primo
		for (var r=0, i=1, e=v.length; i<e; i+=1) r+=v[i]; return r
	}
	
	function shift1(v) { // clona v dal secondo elemento
		for (var r=[], i=1, e=v.length; i<e; i+=1) r[i-1]=v[i]; return r
	}
	
	function sub0(v, a) { // clona v valorizzando il primo elemento con la differenza tra il primo elemento ed a
		for (var r=[v[0]-a], i=1, e=v.length; i<e; i+=1) r[i]=v[i]; return r
	}
	
	function subn(c, a) { // crea un vettore con la differenza fra i corrispondenti elementi del primo e del secondo vettore
		for (var r=[], i=0, e=c.length; i<e; i+=1) r[i]=c[i]-a[i]; return r
	}
	
	function Mn(r, c) {
		if (sum(r) != sum(c)) return
		return Mn(r, c)
		
		function Mn(r, c) {
			if (r.length == 2) {
				if (c.length == 2) {
					return min(r[0],c[0])+1 - max(0,r[0]-c[1])
				}
				for (var n=0, a00=max(0,r[0]-sum1(c)), e=min(r[0],c[0]); a00<=e; a00+=1) {
					var a10 = c[0]-a00
					n += Mn( [r[0]-a00, r[1]-a10], shift1(c) ) 
				}
				return n
			}
			for (var n=0, r1=R(r,c), i=0, e=r1.length; i<e; i+=1)
				n += Mn( shift1(r), subn(c, r1[i])) 
			return n
		}
	}
	
	function R(r, c) {
		var r1 = sum1(r)
		return R(r[0], c)
		
		function R(r0, c) {
			if (c.length == 2) {
				for (var v=[], a0=max(0,c[0]-r1), e=min(c[0],r0); a0<=e; a0+=1)
					v.push( [a0, r0-a0] ) // aggiunge una nuova riga [a0,a1] in fondo a v
				return v
			}
			for (var v=[], a0=max(0,c[0]-r1), e=min(c[0],r0); a0<=e; a0+=1) {
				var vs = R(r0-a0, shift1(c))
				for (var i in vs) {
					var vi = vs[i]
					vi.unshift(a0) // aggiunge a0 in testa a vi
					v.push(vi) // aggiunge vi in fondo a v
				}
			}
			return v
		}
	}
	
	function M(r, c) {
		if (sum(r) != sum(c)) return
		return M(r, c)
		
		function M(r, c) {
			if (r.length == 2) {
				if (c.length == 2) {
					for (var m=[], a00=max(0,r[0]-c[1]), e=min(r[0],c[0]); a00<=e; a00+=1) {
						var a01 = r[0] - a00 
						var a10 = c[0] - a00
						var a11 = r[1] - a10 // = c[1]-a10
	 					m.push( [[a00, a01], [a10, a11]] ) // genera la matrice 2x2
					}
					return m
				}
				for (var m=[], a00=max(0,r[0]-sum1(c)), e=min(r[0],c[0]); a00<=e; a00+=1) {
					var a10 = c[0]-a00
					var ms = M( [r[0]-a00, r[1]-a10], shift1(c) )
					for (var i in ms) {
						var mi = ms[i]
						mi[0].unshift(a00) // aggiunge a00 in testa alla prima riga di mi
						mi[1].unshift(a10) // aggiunge a10 in testa alla seconda riga di mi
						m.push(mi) // aggiunge mi in fondo a m
					}
				}
				return m
			}
			for (var m=[], v=R(r,c), i=0, e=v.length; i<e; i+=1) {
				var vi = v[i]
				var ms = M( shift1(r), subn(c, vi) )
				for (var j in ms) {
					var mj = ms[j]
					mj.unshift(vi) // aggiunge vi in testa mj
					m.push(mj) // aggiunge mj in fondo a m
				}
			}
			return m
		}
	}
	
	function writeM(r, c) {
		var m = M(r, c)
		if (!m) 
			document.write(m, '<br>')
		else {
			for (var i=0, ei=m.length; i<ei; i+=1) {
				var mi=m[i], ok=check(mi, r, c) 
				//if (ok) continue
				document.write('<div style="float:left; margin:10px">')
				document.write(i+1, ' ', ok ? '' : 'errata!', '<br>')
				document.write('-----', '<br>')
				for (var j=0, ej=mi.length; j<ej; j+=1) document.write(mi[j], '<br>')
				document.write('</div>')
			}
		}
	}

	function check(m,r,c) {
		if (m.length != r.length) return false
		for (var i=0; i<r.length; i+=1) {
			var rn = m[i]
			if (rn.length != c.length) return false
			for (var tr=0, j=0; j<c.length; j+=1)  {
				if (rn[j] < 0) return false 
				tr += rn[j]
			}
			if (tr != r[i]) return false
		}
		for (var i=0; i<c.length; i+=1) {
			for (var tc=0, j=0; j<r.length; j+=1) tc += m[j][i]
			if (tc != c[i]) return false
		}
		return true
	}
	
	//document.write( Mn([3,1,3], [3,2,2]), '<br>','<br>' )
	
	writeM( [3,1,3], [3,2,2] )
	
	//writeM( [4,3,3], [3,1,4,2] )
	
</script>


</body>
</html>
